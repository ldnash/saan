var transitRouteNumbers=[242,40],arcgisURL="https://services1.arcgis.com/fBc8EJBxQRMcHlei/arcgis/rest/services/SAAN1/FeatureServer/",arcgisQuery="/query?f=geojson&outSR=4326&where="+encodeURIComponent("\"ISEXTANT\"='Yes'"),majorLayers={},minorLayers={},topLayers={},bcycleData,map,transitRoutes=[],transitStops=[],transitRouteOnestops=[],NPMap,script;
NPMap={center:{lat:29.369245,lng:-98.475088},div:"map",events:[{fn:function(){if(15<=map.getZoom()){for(var e in minorLayers)minorLayers[e].addTo(map);for(var b in topLayers)map.removeLayer(topLayers[b])}else{for(var c in minorLayers)map.removeLayer(minorLayers[c]);for(var a in topLayers)topLayers[a].addTo(map)}},type:"zoomend"}],hooks:{init:function(e){$(document).ready(function(){var b,c;map=NPMap.config.L;$("#map").css("padding-top",$(".navbar").height());$("body").append('<div class="container" id="legendCont"><div class="row"><div id="trueLegend" class="col-xs-12 col-sm-5 col-md-4 col-lg-4 boxDiv"><button id="trueLegendButton" type="button" class="boxes btn btn-primary">Legend</button><div id="trueLegendContent" class="boxes"><button type="button" class="close" id="buttonCloseLegend" aria-hidden="true">&times;</button><div class="panel panel-default boxes-panel" id="trueLegend-panel"><h4>Legend</h4><ul id="legendList" class="list-group"><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/riverRoute.gif" alt="River Walk"></div>River Walk Trail (Walk + Bike)</div></li><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/riverRoute_ped.gif" alt="River Walk (Walk only)"></div>River Walk Trail (Walk Only)</div></li><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/onRoadRoutes_bikePed.gif" alt="Suggested Walk + Bike Streets"></div>Road Route (Walk + Bike + Drive)</div></li><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/onRoadRoutes_bikeonly.gif" alt="Bike Only Streets for Experienced Cyclists"></div>Road Route (Bike + Drive)</div></li><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/aceRoute.gif" alt="Acequia Trails (Unpaved)"></div>Acequia Trail (Unpaved)</div></li><li class="list-group-item"><div class="legendRow"><div class="legendIcon"><img src="https://nationalparkservice.github.io/saan-trip-planner/icons/bcycle.gif" alt="Bcycle logo"></div><a href="https://sanantonio.bcycle.com/" target="_blank">B-cycle</a></div></li></ul></div></div></div></div><div class="row" style="margin-top:5px;"><div id="checkboxes" class="boxDiv col-lg-4 col-md-4 col-sm-5 col-xs-12"><button class="boxes btn btn-primary" id="buttonTransit" type="button">Show Transit</button></div></div></div>');
b=$("#trueLegendContent");c=$("#trueLegendButton");L.DomEvent.disableClickPropagation(document.getElementById("legendCont"));majorLayers.aceLines=L.npmap.layer.geojson({popup:{description:"These trails provide visitors up-close views of the acequias that originally irrigated the fields around the missions.",title:"{{TRLNAME}}"},styles:{line:{stroke:"#00315e","stroke-opacity":.8}},tooltip:"{{TRLNAME}}",url:arcgisURL+18+arcgisQuery}).addTo(map);majorLayers.aceSites=L.npmap.layer.geojson({popup:{description:"{{NOTES}}",
title:"{{POINAME}}"},styles:{point:{"marker-color":"#00315e","marker-symbol":"dam"}},tooltip:"{{POINAME}}",url:arcgisURL+8+arcgisQuery+"&outFields=POINAME,NOTES"}).addTo(map);majorLayers.missions=L.npmap.layer.geojson({popup:function(a){return"<b>"+a.Full_Name+"</b><p>"+a.Desc+"</p><p><a href="+a.Link+">More information</a></p><p><a href="+a.Directions+">Directions</a></p>"},styles:function(a){return{point:{iconSize:[50,50],iconUrl:a.iconUrl}}},tooltip:"Mission {{Name}}",url:"https://nationalparkservice.github.io/saan-trip-planner/data/cmpndsites.geojson"}).addTo(map);
majorLayers.onStreetBikeOnly=L.npmap.layer.geojson({color:"#ff9900",dashArray:"5, 10",opacity:.8,popup:{title:"Bike and car-only Road Routes"},tooltip:"Bike and car-only Road Routes",url:arcgisURL+21+arcgisQuery+encodeURIComponent("and\"Route_Type\"='Bike Only'")}).addTo(map);majorLayers.onStreetBikePed=L.npmap.layer.geojson({popup:{description:"For cyclists and pedestrians.",title:"Road Routes"},styles:{line:{stroke:"#ff9900","stroke-opacity":.8}},tooltip:"Road Routes",url:arcgisURL+21+arcgisQuery+
encodeURIComponent("and\"Route_Type\"='Bike and Ped'")+encodeURIComponent("and\"TRLNAME\"='Mission Trail Route'")}).addTo(map);majorLayers.riverWalkMain=L.npmap.layer.geojson({popup:{description:"The River Walk and connecting trails.",title:"{{TRLLABEL}}"},styles:{line:{stroke:"#ff0044","stroke-opacity":.8}},tooltip:"{{TRLLABEL}}",url:arcgisURL+21+arcgisQuery+encodeURIComponent("and\"Route_Type\"='Bike and Ped'")+encodeURIComponent("and\"level_\"='Main = River Walk'")+"&outFields=TRLLABEL"}).addTo(map);
majorLayers.cityParks=L.npmap.layer.geojson({popup:{description:"{{ParkType}}",title:"{{ParkName}}"},styles:{polygon:{fill:"#9bb474","fill-opacity":.1,"stroke-width":0}},tooltip:"{{ParkName}}",url:"https://nationalparkservice.github.io/saan-trip-planner/data/cityParks.geojson"}).addTo(map);minorLayers.pavilion=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-symbol":"building"}},tooltip:"{{POINAME}}",url:arcgisURL+16+arcgisQuery});minorLayers.riverAccess=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},
styles:{point:{"marker-symbol":"ferry"}},tooltip:"{{POINAME}}",url:arcgisURL+14+arcgisQuery});minorLayers.water=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-symbol":"water"}},tooltip:"{{POINAME}}",url:arcgisURL+13+arcgisQuery});minorLayers.picnic=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-symbol":"park"}},tooltip:"{{POINAME}}",url:arcgisURL+9+arcgisQuery});minorLayers.restroom=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-symbol":"toilets"}},
tooltip:"{{POINAME}}",url:arcgisURL+7+arcgisQuery});minorLayers.parking=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-symbol":"parking"}},tooltip:"Parking Area",url:arcgisURL+10+arcgisQuery});minorLayers.ped=L.npmap.layer.geojson({popup:{description:"Only pedestrians are allowed on downtown sections of the River Walk and certain other trails.",title:"Pedestrians-only trail"},styles:{line:{stroke:"#ff0044","stroke-opacity":.8,"stroke-width":1.3}},tooltip:"Pedestrians-only trail",
url:arcgisURL+21+arcgisQuery+encodeURIComponent("and\"Route_Type\"='Ped Only'")+"&outFields=TRLLABEL"});minorLayers.secondary=L.npmap.layer.geojson({color:"#ff0044",opacity:.8,popup:{description:"The River Walk and connecting trails.",title:"River Walk Connections"},tooltip:"{{TRLLABEL}}",url:arcgisURL+21+arcgisQuery+encodeURIComponent("and\"Route_Type\"='Bike and Ped'")+encodeURIComponent("and\"level_\"='Secondary - Riverwalk or Mission Tr. offshoots'")+"&outFields=TRLLABEL"});minorLayers.visitorCenters=
L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-color":"#d39700","marker-symbol":"star"}},tooltip:"{{POINAME}}",url:arcgisURL+17+arcgisQuery});minorLayers.information=L.npmap.layer.geojson({popup:{title:"{{POINAME}}"},styles:{point:{"marker-color":"#d39700","marker-symbol":"circle"}},tooltip:"{{POINAME}}",url:arcgisURL+3+arcgisQuery});topLayers.minor=L.npmap.layer.geojson({cluster:!0,popup:{description:"{{Name}}",title:"{{Facility}}"},styles:{point:{"marker-symbol":"circle"}},
tooltip:"{{Facility}}",url:"https://nationalparkservice.github.io/saan-trip-planner/data/CombinedFacilities.geojson"}).addTo(map);for(i in transitRouteNumbers)$.ajax({success:function(a){var c=L.npmap.layer.geojson({popup:{description:"<a href=https://www.viainfo.net/BusService/RiderTool.aspx?ToolChoice=Schedules>Check VIA Transit for service times and schedules</a></p>",title:"Bus Route {{name}}"},styles:{line:{stroke:"#45000d","stroke-opacity":.8}},data:a});transitRoutes.push(c);$.ajax({success:function(a){a=
L.npmap.layer.geojson({popup:function(a){console.log(a);var c=new Date,b=""+(c.getMonth()+1),d=""+c.getDate(),e=c.getFullYear();2>b.length&&(b="0"+b);2>d.length&&(d="0"+d);var b=[e,b,d].join("-"),h;$.ajax({url:"https://transit.land/api/v1/schedule_stop_pairs?origin_onestop_id="+a.onestop_id+"&date="+b,type:"GET",async:!1,success:function(b){console.log(b);b=b.schedule_stop_pairs;var d=("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2);b=b.filter(function(a,
b,c){return d<=a.origin_departure_time});b.sort(function(a,b){return a.origin_departure_time<b.origin_departure_time?-1:a.origin_departure_time>b.origin_departure_time?1:0});for(var e="<table><tr><td style='text-align: center'><b>Route</b></td><td style='text-align: center'><b>Destination</b></td><td style='text-align: center'><b>Departure Time</b></td></tr>",g=0;g<b.length&&5>g;){var f=b[g],k=f.route_onestop_id.split("-")[2];console.log("route",k);var l=null==f.trip_headsign?"":f.trip_headsign,f=
parseTime(f.origin_departure_time),e=e+("<tr><td style='text-align: center'><p>"+k+"</p></td><td style='text-align: center'><p>"+l+"</p></td><td style='text-align: center'><p>"+f+"</p></td></tr>");g++}d+="</table>";h="<b>Bus Stop: "+a.name+"</b><br>Schedules vary significantly <br><br>"+e+" <p><a href=https://www.viainfo.net/BusService/RiderTool.aspx?ToolChoice=Schedules>Check VIA Transit for service times and schedules</a></p>"},error:function(){console.log("error getting data")}});return h},styles:{point:{"marker-symbol":"bus"}},
tooltip:"Bus Stop",data:a});transitStops.push(a)},type:"GET",url:"https://transit.land/api/v1/stops.geojson?served_by="+a.features[0].properties.onestop_id})},type:"GET",url:"https://transit.land/api/v1/routes.geojson?operated_by=o-9v1z-viametropolitantransit&imported_with_gtfs_id=true&gtfs_id="+String(transitRouteNumbers[i])});$.ajax({beforeSend:function(a){a.setRequestHeader("ApiKey","49AB876F-017E-47BE-84BD-876AE6A6151D")},headers:{ApiKey:"49AB876F-017E-47BE-84BD-876AE6A6151D","Cache-Control":"no-cache"},
success:function(a){var b=L.layerGroup();bcycleData=a.data;for(var c in bcycleData){a=bcycleData[c];var d=L.marker([a.Location.Latitude,a.Location.Longitude]);d.bcycleID=a.Id;d.title=a.Name;d.openBikes=a.BikesAvailable;d.openDocks=a.DocksAvailable;d.status=a.Status;d.bindPopup("<b>B-cycle: "+d.title+"</b><p>Bikes available: "+d.openBikes+"<br>Docks available: "+d.openDocks+'</p><p>For more information on B-cycle, visit <a href="https://sanantonio.bcycle.com/">sanantonio.bcycle.com</a></p>');d.setIcon(L.icon({iconSize:[20,
20],iconUrl:"https://nationalparkservice.github.io/saan-trip-planner/icons/bcycle.gif"}));b.addLayer(d)}minorLayers.bcycle=b},type:"GET",url:"https://enigmatic-castle-8864.herokuapp.com/?type=json&url="+encodeURIComponent("https://publicapi.bcycle.com/api/1.0/ListProgramKiosks/48")});$("#buttonCloseLegend").click(function(){b.hide();c.show()});c.click(function(){c.hide();b.show()});$("#buttonTransit").click(function(){var a=$(this);if(-1<a.text().indexOf("Hide")){for(j in transitRouteNumbers)map.removeLayer(transitStops[j]).removeLayer(transitRoutes[j]);
a.removeClass("active").text("Show Transit")}else{for(j in transitRouteNumbers)map.addLayer(transitStops[j]).addLayer(transitRoutes[j]);a.addClass("active").text("Hide Transit")}});768>$(window).width()&&$("#buttonCloseLegend").trigger("click");e()})},preinit:function(e){var b=L.npmap.util._;b.appendCssFile(["https://nationalparkservice.github.io/saan-trip-planner/assets/css/main.min.css"],function(){b.appendJsFile("https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",function(){b.appendJsFile("https://www.nps.gov/lib/bootstrap/3.3.2/js/nps-bootstrap.min.js",
e)})})}},locateControl:!0,zoom:13};script=document.createElement("script");script.src="https://www.nps.gov/lib/npmap.js/3.0.18/npmap-bootstrap.min.js";document.body.appendChild(script);function parseTime(e){e=e.split(":");var b="A.M.",c=parseInt(e[0]);24<=c&&(c-=24);12<c&&24>c&&(c-=12,b="P.M.");0==c&&(c=12);12==c&&(b="P.M.");return c.toString()+":"+e[1]+" "+b};